<!DOCTYPE html>
<html>
<head>
	<title>Dollar-First-Averaging (DFA) on Bitcoin data from Binance</title>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body style="background-color: black;">
	<h1>Dollar-First-Averaging (DFA) on Bitcoin data from Binance</h1>
	<p>This page demonstrates the Dollar-First-Averaging (DFA) strategy on historical Bitcoin price data from Binance. DFA is a passive investment strategy that involves investing a fixed dollar amount at regular intervals, regardless of the market price.</p>
	<p>In this demonstration, we will invest $1000 in Bitcoin every week, starting from January 1, 2022, until March 1, 2023.</p>
	
	<h2>Results</h2>
	<!--<canvas id="myChart" width="800" height="400"></canvas>-->
	<div id="chart" style="position: relative; margin-left: auto; margin-right: auto;"></div>
	
	<script>
	// Define variables
	const startingDate = new Date("2023-01-01");
	const endingDate = new Date("2023-03-01");
	const investmentAmount = 100;
	const apiUrl = "https://api.binance.com/api/v3/klines";
	const symbol = "BTCEUR";
	const interval = "1d";
	const limit = 100;
	
	// Define functions
	function formatDate(date) {
		let year = date.getFullYear();
		let month = date.getMonth() + 1;
		let day = date.getDate();
		return year + "-" + (month < 10 ? "0" : "") + month + "-" + (day < 10 ? "0" : "") + day;
	}
	
	function calculateInvestment(startDate, endDate, amount) {
		let investmentArray = [];
		let currentDate = new Date(startDate.getTime());
		while (currentDate <= endDate) {
		let formattedDate = formatDate(currentDate);
		investmentArray.push({
			date: formattedDate,
			investment: amount,
		});
		currentDate.setDate(currentDate.getDate() + 1);
		}
		return investmentArray;
	}
	
	function fetchData(url) {
		return fetch(url)
		.then(response => response.json())
		.then(data => data.map(item => [item[0], item[4]]))
		.catch(error => console.log(error));
	}
	
	function calculatePortfolioValue(investments, prices) {
		let portfolioValue = 0;
		let totalBitcoinPurchased = 0;
		let portfolioData = [];
		for (let i = 0; i < investments.length; i++) {
		let investmentDate = new Date(investments[i].date);
		let priceDateIndex = prices.findIndex(item => new Date(item[0]) >= investmentDate);
		if (priceDateIndex !== -1) {
			let price = parseFloat(prices[priceDateIndex][1]);
			let bitcoinPurchased = investments[i].investment / price;
			totalBitcoinPurchased += bitcoinPurchased;
			portfolioValue = totalBitcoinPurchased * price;
		}
		portfolioData.push({
			date: investments[i].date,
			value: portfolioValue.toFixed(2),
		});
		}
		return portfolioData;
	}
	
	// Main code
	let investments = calculateInvestment(startingDate, endingDate, investmentAmount);
	let url = `${apiUrl}?symbol=${symbol}&interval=${interval}&limit=${limit}`;

fetchData(url).then(prices => {
	let portfolioData = calculatePortfolioValue(investments, prices);
	let dates = portfolioData.map(item => item.date);
	let values = portfolioData.map(item => item.value);
	
	//let ctx = document.getElementById('myChart').getContext('2d');
	
	const chart = LightweightCharts.createChart(document.getElementById('chart'), {
	width: 800,
	height: 400,
	});

	const lineSeries = chart.addLineSeries({
	color: 'rgba(255, 99, 132, 0.8)',
	lineWidth: 3,
	});

	const data = [];
	for (let i = 0; i < dates.length; i++) {
	data.push({ time: dates[i], value: values[i] });
	}

	lineSeries.setData(data);

	chart.applyOptions({
	priceScale: {
		position: 'right',
		mode: LightweightCharts.PriceScaleMode.Logarithmic,
		borderColor: 'rgba(197, 203, 206, 1)',
	},
	timeScale: {
		timeVisible: true,
		borderColor: 'rgba(197, 203, 206, 1)',
	},
	layout: {
		backgroundColor: '#ffffff',
		textColor: '#000000',
	},
	grid: {
		vertLines: {
		color: 'rgba(197, 203, 206, 1)',
		},
		horzLines: {
		color: 'rgba(197, 203, 206, 1)',
		},
	},
	crosshair: {
		vertLine: {
		color: 'rgba(197, 203, 206, 1)',
		},
		horzLine: {
		color: 'rgba(197, 203, 206, 1)',
		},
	},
	});
});
</script>
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</body>
</html>


